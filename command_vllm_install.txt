# This file contains the shell commands to build and install vLLM.

# 1. Update system and install dependencies
apt-get update
apt-get install -y build-essential libnuma-dev

# 2. Use the vLLM source copied from the repository submodule
# The Docker build copies `third_party/vllm` into /app/vllm_source.
cd /app/vllm_source

# 4. Create and activate a Python virtual environment
python -m venv myenv
source myenv/bin/activate

# 5. Upgrade pip and install the 'build' and package 'addict'
pip install --upgrade pip
pip install build
pip install addict

# 6. Install Python dependencies using the official requirements file
pip install -r requirements/cpu-build.txt --extra-index-url https://download.pytorch.org/whl/cpu

# 7. Build the vLLM wheel
VLLM_TARGET_DEVICE=cpu python -m build --wheel --no-isolation

# 8. Install the wheel you just built
pip install dist/*.whl